import{el,icons}from'./lib/dom.js';import{kbBind,kbUpdate,esc}from'./lib/utils.js';import{clearChat}from'./core/state.js';import{SUNE,fetchDotSune,renderSuneHTML}from'./core/sune.js';import{THREAD}from'./core/thread.js';import{initSidebars,renderSidebar,renderThreads}from'./components/sidebars.js';import{initPopovers,hideThreadPopover,hideSunePopover}from'./components/popovers.js';import{initSettings}from'./components/settings.js';import{initAccountSettings}from'./components/account-settings.js';import{initComposer,updateAttachBadge}from'./components/composer.js';import{initImportExport}from'./lib/import-export.js';import{initSync}from'./lib/sync.js';
export async function reflectActiveSune(){const a=SUNE.active;el.suneBtnTop.title=`Settings — ${a.name}`;el.suneBtnTop.innerHTML=a.avatar?`<img src="${esc(a.avatar)}" alt="" class="h-8 w-8 rounded-full object-cover"/>`:'✺';el.footer.classList.toggle('hidden',!!a.settings.hide_composer);await renderSuneHTML();icons()}
async function init(){await fetchDotSune('sune-org/store@main/marketplace.sune');await fetchDotSune('sune-org/store@main/forum.sune');await THREAD.load();renderThreads();renderSidebar();reflectActiveSune();clearChat();updateAttachBadge();icons();kbBind();kbUpdate();initSidebars();initPopovers();initSettings();initAccountSettings();initComposer();initImportExport();initSync()}
$(window).on('resize',()=>{hideThreadPopover();hideSunePopover()})
init()
